/* =========================================================
   A SEED - RESPONSIVE & DYNAMIC THEME V6.1 (UI FIX)
   ========================================================= */
@import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');

/* --- 1. Base Colors (Neutral Mood) --- */
:root {
  /* Dark Mode (Default) */
  --bg: #0f172a; --panel: #1e293b; --fg: #e2e8f0; --muted: #94a3b8;
  --border: #334155; --mood: #60a5fa; --shadow: 0 25px 50px -12px rgba(0,0,0,.5);
  --input-bg: #0f172a; --chip-bg: rgba(148, 163, 184, 0.1);
  --msg-me-bg: #3b82f6; --msg-me-fg: #ffffff;
  --msg-ai-bg: #334155; --msg-ai-fg: #e2e8f0;
}
:root.light {
  /* Light Mode */
  --bg: #f8fafc; --panel: #ffffff; --fg: #334155; --muted: #64748b;
  --border: #e2e8f0; --mood: #3b82f6; --shadow: 0 25px 50px -12px rgba(0,0,0,.1);
  --input-bg: #f1f5f9; --chip-bg: #e2e8f0;
  --msg-me-bg: #3b82f6; --msg-me-fg: #ffffff;
  --msg-ai-bg: #e2e8f0; --msg-ai-fg: #334155;
}

/* --- 2. Dynamic Mood Color Overrides --- */
body.mood-sadness { --mood: #94a3b8; --msg-me-bg: #64748b; }
:root.light body.mood-sadness { --mood: #64748b; }
body.mood-joy { --mood: #22c55e; --msg-me-bg: #16a34a; }
:root.light body.mood-joy { --mood: #16a34a; }
body.mood-anger { --mood: #ef4444; --msg-me-bg: #dc2626; }
:root.light body.mood-anger { --mood: #dc2626; }
body.mood-fear { --mood: #14b8a6; --msg-me-bg: #0d9488; }
:root.light body.mood-fear { --mood: #0d9488; }
body.mood-surprise { --mood: #a855f7; --msg-me-bg: #9333ea; }
:root.light body.mood-surprise { --mood: #9333ea; }
body.mood-disgust { --mood: #84cc16; --msg-me-bg: #65a30d; }
:root.light body.mood-disgust { --mood: #65a30d; }

/* --- 3. Base Layout & Structure --- */
* { box-sizing: border-box; }
html, body { height: 100%; }
body {
  margin:0; color:var(--fg);
  background: var(--bg);
  font-family: 'Inter', sans-serif;
  font-size: 16px; line-height: 1.7;
  display: flex; flex-direction: column; height: 100vh;
  transition: background-color .8s ease, color .8s ease;
}

.appbar {
  flex-shrink: 0;
  display:flex; justify-content:space-between; align-items:center; padding: 16px 32px;
  border-bottom: 1px solid var(--border); 
  background: color-mix(in srgb, var(--bg) 80%, transparent); 
  backdrop-filter: blur(16px);
  position: relative; z-index: 10;
  transition: border-color .8s ease, background-color .8s ease;
}
.brand { display:flex; align-items:center; gap:16px; }
.logo { font-size: 2rem; }
.brand-title { font-weight: 700; font-size: 1.5rem; letter-spacing: -0.5px; }
.brand-tagline { font-size: 0.85rem; color: var(--muted); font-weight: 500; letter-spacing: 0.5px; }
.controls { display:flex; gap:12px; align-items:center; }
.chip { 
  border:1px solid var(--border); padding:10px 20px; border-radius:12px; 
  color:var(--muted); background:var(--chip-bg); cursor: pointer; transition: all .4s ease;
  font-size: 0.95rem; font-weight: 600; white-space: nowrap;
}
.chip:hover { color: var(--fg); background: var(--panel); transform: translateY(-2px); }

.user-menu { position: relative; display: inline-block; }
.user-chip { display: flex; align-items: center; gap: 8px; }
.dropdown-menu {
    display: none; position: absolute; right: 0; top: calc(100% + 10px);
    background-color: var(--panel); border: 1px solid var(--border);
    border-radius: 12px; min-width: 160px; box-shadow: var(--shadow);
    z-index: 20; padding: 8px; animation: fadeIn 0.2s ease-out;
}
.dropdown-menu.show { display: block; }
.dropdown-menu a { color: var(--fg); padding: 10px 16px; text-decoration: none; display: block; border-radius: 8px; }
.dropdown-menu a:hover { background-color: var(--chip-bg); }

.chat-container {
  flex-grow: 1; width: 100%; max-width: 1200px; margin: 0 auto;
  display: flex; flex-direction: column; overflow: hidden; position: relative;
}

.mood-orb-container { position: absolute; top: 20px; right: 40px; z-index: 5; pointer-events: none; }
.mood-orb {
    width: 20px; height: 20px; border-radius: 50%;
    background-color: var(--mood);
    box-shadow: 0 0 20px 5px var(--mood), 0 0 40px 15px color-mix(in srgb, var(--mood) 50%, transparent);
    transition: background-color .8s ease, box-shadow .8s ease;
    animation: breathe 5s infinite ease-in-out;
}
@keyframes breathe { 0%, 100% { transform: scale(0.9); opacity: 0.8; } 50% { transform: scale(1.1); opacity: 1; } }

.chat-area { flex-grow: 1; overflow-y: auto; padding: 40px; scroll-behavior: smooth; }
.group { display:flex; gap:20px; margin:32px 0; max-width: 85%; }
.group.user { align-self: flex-end; flex-direction: row-reverse; }
.group .ai-avatar { font-size: 2rem; flex-shrink: 0; width: 52px; height: 52px; display: grid; place-items: center; background: var(--msg-ai-bg); border-radius: 16px; transition: background-color .8s ease; }
.message-content { display: flex; flex-direction: column; gap: 10px; align-items: flex-start; }
.group.user .message-content { align-items: flex-end; }
.msg { padding:20px 28px; border-radius:24px; line-height: 1.6; }
.msg.me { background: var(--msg-me-bg); color: var(--msg-me-fg); border-bottom-right-radius: 4px; }
.msg.ai { background: var(--msg-ai-bg); color: var(--msg-ai-fg); border-bottom-left-radius: 4px; }
.emotion-tag { font-size: 0.8rem; font-weight: 600; text-transform: uppercase; letter-spacing: 1px; padding: 4px 12px; border-radius: 8px; background: var(--chip-bg); color: var(--muted); opacity: 0.8; }

.composer-area { flex-shrink: 0; padding: 20px 40px 40px 40px; background: linear-gradient(to top, var(--bg) 80%, transparent); transition: background-color .8s ease; width: 100%; max-width: 1200px; margin: 0 auto; }
.composer { position: relative; }
.composer textarea {
  width: 100%; min-height:64px; max-height:300px; resize:vertical; padding: 20px 70px 20px 24px;
  border-radius:24px; border:2px solid var(--border); background:var(--panel); 
  color:var(--fg); font-size:1.1rem; outline: none; transition: all .3s ease; box-shadow: var(--shadow);
}
.composer textarea:focus { border-color: var(--mood); box-shadow: 0 8px 30px -10px color-mix(in srgb, var(--mood) 50%, transparent); }
.send { 
  position: absolute; right: 10px; bottom: 10px; width:48px;height:48px;border-radius:18px;
  border:none;background:var(--mood); color:#fff;font-size:24px;cursor:pointer; 
  display: grid; place-items: center; transition: all .4s ease;
}
.send:hover { transform: scale(1.1); }

/* --- 5. Markdown, Modals, & Other Styles --- */
.msg p { margin: 0 0 10px 0; }
.msg p:last-child { margin-bottom: 0; }
.msg strong { font-weight: 700; color: var(--fg); transition: color .8s ease; }
.msg em { font-style: italic; opacity: 0.9; }
.msg ul, .msg ol { padding-left: 24px; margin: 12px 0; }
.msg li { margin-bottom: 6px; }

/* MODALS (FIXED) */
.modal {
  display: none; /* Hide by default */
  position: fixed;
  inset: 0;
  z-index: 1000;
  align-items: center;
  justify-content: center;
  background: rgba(17, 24, 39, 0.8);
  backdrop-filter: blur(16px);
  padding: 20px;
}
.modal.show {
  display: flex; /* Show when class is added */
}
.panel {
  background: var(--panel); border: 1px solid var(--border);
  border-radius: 32px; padding: 40px;
  box-shadow: var(--shadow);
  width: min(600px, 90vw);
  max-height: 90vh;
  overflow-y: auto;
  transition: background-color .8s ease, border-color .8s ease;
}
.panel.center { text-align:center; }
.panel h1 { margin:16px 0; font-size: 2.5rem; letter-spacing: -1px; }
.actions { display:flex; gap:16px; justify-content:center; margin-top:32px; }
.btn { padding:14px 28px; border-radius:16px; border:1px solid var(--border); background:var(--chip-bg); color:var(--fg); cursor:pointer; font-weight: 600; font-size: 1rem; transition: all .4s ease; }
.btn.primary { background:var(--mood); color:#fff; border-color: var(--mood); box-shadow: 0 4px 20px -5px var(--mood); }
.btn:hover { transform: translateY(-2px); }

.histbar, .stats-header { display:flex; justify-content:space-between; align-items: center; gap:10px; margin-bottom:24px; }
.histbar input { flex:1; padding:14px; border-radius:16px; border:2px solid var(--border); background:var(--input-bg); color:var(--fg); font-size: 1rem; transition: all .4s ease; }
.histbar input:focus { border-color: var(--mood); outline: none; }
.histlist { display:grid; gap:12px; max-height:60vh; overflow:auto; padding-right: 8px;}
.histitem { cursor:pointer; padding:20px; border-radius:20px; border:1px solid var(--border); background: color-mix(in srgb, var(--panel) 40%, var(--bg)); transition: all .2s; }
.histitem:hover { background: var(--panel); transform: scale(1.02); }
.histitem .title { font-weight: 600; font-size: 1.1rem; margin-bottom: 4px; }
.histitem .meta { color:var(--muted); font-size:0.9rem; }
.chart-container { position: relative; height: 400px; width: 100%; }

.watermark { text-align: center; font-size: 0.85rem; font-weight: 500; opacity:.6; color:var(--muted); pointer-events:none; margin-bottom: 16px; }
.dots i { display:inline-block;width:10px;height:10px;border-radius:50%;background:var(--muted);margin:0 4px;animation:blink 1.4s infinite ease-in-out both; }
@keyframes blink { 0%,80%,100%{transform: scale(0);} 40%{transform: scale(1.0);} }

/* --- 6. RESPONSIVE DESIGN FOR MOBILE --- */
@media (max-width: 768px) {
    body { font-size: 15px; }
    
    .appbar { padding: 12px 16px; flex-wrap: wrap; justify-content: center; gap: 12px; }
    .brand { width: 100%; justify-content: center; }
    .brand-title { font-size: 1.3rem; }
    .brand-tagline { display: none; }
    .controls { width: 100%; justify-content: center; overflow-x: auto; padding-bottom: 8px; flex-wrap: nowrap;}
    .chip { padding: 8px 12px; font-size: 0.8rem; flex-shrink: 0; }

    .chat-container { padding: 0; }
    .chat-area { padding: 16px 12px; }
    .group { max-width: 95%; gap: 10px; margin: 20px 0; }
    .group .ai-avatar { width: 40px; height: 40px; font-size: 1.5rem; border-radius: 12px; }
    .msg { padding: 14px 20px; }
    
    .mood-orb-container { top: 10px; right: 16px; }
    .mood-orb { width: 15px; height: 15px; }

    .composer-area { padding: 8px; background: var(--panel); border-top: 1px solid var(--border); position: sticky; bottom: 0; }
    .watermark { display: none; }
    .composer textarea { font-size: 1rem; padding: 14px 56px 14px 18px; min-height: 52px; border-radius: 16px;}
    .send { width: 40px; height: 40px; right: 6px; bottom: 6px; border-radius: 14px; }
    
    .panel { width: 95vw; padding: 24px; }
    .panel h1 { font-size: 2rem; }
}

/* --- 7. Final Polish (Scrollbar, Animations) --- */
::-webkit-scrollbar { width: 10px; }
::-webkit-scrollbar-track { background: transparent; }
::-webkit-scrollbar-thumb { background: var(--border); border-radius: 10px; border: 3px solid transparent; background-clip: padding-box; }
::-webkit-scrollbar-thumb:hover { background-color: var(--muted); }